(self.webpackChunk_skybrush_live=self.webpackChunk_skybrush_live||[]).push([[529],{62360:(t,e,i)=>{"use strict";var n=i(79697),o=i(2999);const s={38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD",67:"KeyC",69:"KeyE",16:"ShiftLeft"};const{THREE:r}=o.Z,a=.001,h=new Set(["KeyW","KeyA","KeyS","KeyD","KeyE","KeyC","ArrowUp","ArrowLeft","ArrowRight","ArrowDown","ShiftLeft","ShiftRight"]),l=Math.PI/2,d=t=>t?t.isVector3?t:Array.isArray(t)?new r.Vector3(t[0]||0,t[1]||0,t[2]||0):new r.Vector3(t.x||0,t.y||0,t.z||0):new r.Vector3;o.Z.registerComponent("advanced-camera-controls",{dependencies:["position","rotation","camera"],schema:{acceleration:{default:65},acceptsKeyboardEvent:{default:"legacy",oneOf:["legacy","notEditable","always"]},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},dragSensitivity:{default:2},ecAxis:{default:"y",oneOf:["x","y","z"]},ecEnabled:{default:!0},ecInverted:{default:!1},embedded:{default:!1},enabled:{default:!0},fly:{default:!1},maxAltitude:{default:Number.NaN,type:"number"},minAltitude:{default:Number.NaN,type:"number"},maxZoom:{default:5},minZoom:{default:1},mouseDragEnabled:{default:!0},mouseWheelEnabled:{default:!0},mouseWheelInverted:{default:!1},mouseWheelSensitivity:{default:1},reverseMouseDrag:{default:!0},reverseTouchDrag:{default:!0},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1},targetPosition:{type:"vec3"},targetLookAt:{type:"vec3"},targetZoom:{default:1},transitionDuration:{default:1},touchDragEnabled:{default:!0},zoomStep:{default:1.5}},init(){this.keys={},this.easing=1.1,this.velocity=new r.Vector3,this.mouseDrag={active:!1,initialRotation:new r.Euler,startedAtX:null,startedAtY:null},this.transition={active:!1,startedAt:null,endsAt:null,duration:null,positionCurve:null,rotationFunc:null},this._zoomOperation={active:!1,startedAt:null,endsAt:null,duration:null,curve:null,velocity:0},this._bindMethods(),this._attachVisibilityEventListeners()},tick(t,e){this.transition.active?this._tickTransition(t,e):this._tickKeyboardControl(t,e),this._zoomOperation.active&&this._tickZoom(t,e)},remove(){this._removeKeyEventListeners(),this._removeMouseEventListeners(),this._removeVisibilityEventListeners()},play(){this._attachKeyEventListeners(),this._attachMouseEventListeners()},pause(){this.keys={},this._removeKeyEventListeners(),this._removeMouseEventListeners()},update(t){const{targetLookAt:e,targetPosition:i,targetZoom:o}=t,{targetLookAt:s,targetPosition:r,targetZoom:a}=this.data;i&&e&&(i.x!==r.x||i.y!==r.y||i.z!==r.z||e.x!==s.x||e.y!==s.y||e.z!==s.z)&&(0,n.Z)(this.keys)&&this._startTransition(),o&&o!==a&&(0,n.Z)(this.keys)&&this._startZoom()},_tickKeyboardControl(t,e){const i=this.data,o=this.velocity;if(!o[i.adAxis]&&!o[i.wsAxis]&&!o[i.ecAxis]&&(0,n.Z)(this.keys))return;if(e/=1e3,this._updateVelocity(e),!o[i.adAxis]&&!o[i.wsAxis]&&!o[i.ecAxis])return;const{position:s}=this.el.object3D;s.add(this._getMovementVector(e)),!Number.isNaN(this.data.minAltitude)&&s.y<this.data.minAltitude&&(s.y=this.data.minAltitude),!Number.isNaN(this.data.maxAltitude)&&s.y>this.data.maxAltitude&&(s.y=this.data.maxAltitude)},_tickTransition:function(){const t=new r.Vector3;return function(e,i){null===this.transition.startedAt&&(this.transition.startedAt=e-i,this.transition.endsAt=this.transition.startedAt+this.transition.duration);const n=Math.min(1,(e-this.transition.startedAt)/this.transition.duration),o=this.transition.positionCurve,s=this.transition.rotationFunc;o.getPoint(n,t),this.velocity.subVectors(t,this.el.object3D.position).divideScalar(i/1e3),this.el.object3D.position.copy(t),this.el.object3D.quaternion.copy(s(n)),e>=this.transition.endsAt&&this._finishTransition({clearVelocity:!0})}}(),_tickZoom:function(){const t=new r.Vector2;return function(e,i){null===this._zoomOperation.startedAt&&(this._zoomOperation.startedAt=e-i,this._zoomOperation.endsAt=this._zoomOperation.startedAt+this._zoomOperation.duration);const n=Math.min(1,(e-this._zoomOperation.startedAt)/this._zoomOperation.duration);this._zoomOperation.curve.getPoint(n,t);const o=this.el?this.el.sceneEl:null,s=o?o.camera:null;s&&(this._zoomOperation.velocity=(t.x-s.zoom)/i,s.zoom=t.x,s.updateProjectionMatrix()),(!s||e>=this._zoomOperation.endsAt)&&this._finishZoom()}}(),_updateVelocity(t){const{data:e,keys:i,velocity:n}=this,{adAxis:o,wsAxis:s,ecAxis:r}=e;let h,l,d;if(t>.2)return n[o]=0,n[s]=0,void(n[r]=0);const u=i.ShiftLeft||i.ShiftRight,c=(1/this.easing)**(t*(u?20:60));if(0!==n[o]&&(n[o]*=c),0!==n[s]&&(n[s]*=c),0!==n[r]&&(n[r]*=c),Math.abs(n[o])<a&&(n[o]=0),Math.abs(n[s])<a&&(n[s]=0),Math.abs(n[r])<a&&(n[r]=0),!e.enabled)return;const g=e.acceleration*(u?5:1);e.adEnabled&&(h=e.adInverted?-1:1,(i.KeyA||i.ArrowLeft)&&(n[o]-=h*g*t),(i.KeyD||i.ArrowRight)&&(n[o]+=h*g*t)),e.wsEnabled&&(l=e.wsInverted?-1:1,(i.KeyW||i.ArrowUp)&&(n[s]-=l*g*t),(i.KeyS||i.ArrowDown)&&(n[s]+=l*g*t)),e.ecEnabled&&(d=e.ecInverted?-1:1,i.KeyC&&(n[r]-=d*g*t),i.KeyE&&(n[r]+=d*g*t))},_getMovementVector:function(){const t=new r.Vector3(0,0,0),e=new r.Euler(0,0,0,"YXZ");return function(i){const n=this.el.object3D.rotation,o=this.velocity;if(t.copy(o),t.multiplyScalar(i),n){const i=this.data.fly?n.x:Math.abs(n.x)<l?0:Math.PI;e.set(i,n.y,n.z),t.applyEuler(e)}return t}}(),_handleDragRotation(t,e,i){const{initialRotation:n,startedAtX:o,startedAtY:s}=this.mouseDrag,r=t-o,a=e-s,h=(i?1:-1)*this.data.dragSensitivity/1e3,d=Math.abs(n.z)>=l?-1:1;this.el.object3D.rotation.set(n.x+h*d*a,n.y+h*r,n.z)},_startDragRotationAt(t,e){this.transition.active&&this._finishTransition({clearVelocity:!0}),this.mouseDrag.active=!0,this.mouseDrag.initialRotation.copy(this.el.object3D.rotation),this.mouseDrag.startedAtX=t,this.mouseDrag.startedAtY=e},_startTransition(){const t={position:this.data.targetPosition};this.data.targetLookAt&&(t.lookAt=this.data.targetLookAt),this.startTransitionTo(t)},_startZoom(){this.startZoomTo(this.data.targetZoom)},resetZoom(){this.startZoomTo(1)},startTransitionTo:function(){const t=new r.Matrix4,e=new r.Vector3,i=new r.Vector3,n=new r.Vector3,o=new r.Vector3,s=new r.CubicBezierCurve3(e,i,n,o),a=new r.Quaternion,h=new r.Quaternion,l=new r.Quaternion,u=t=>{return l.copy(a).slerp(h,(e=t,-(Math.cos(Math.PI*e)-1)/2));var e};return function({duration:l,position:c,quaternion:g,lookAt:m}){var p;c=c?d(c):this.el.object3D.position,m?t.lookAt(c,d(m),this.el.object3D.up):g?t.makeRotationFromQuaternion((p=g)?Array.isArray(p)?new r.Quaternion(p[1],p[2],p[3],p[0]):p instanceof r.Quaternion?p:new r.Quaternion(p.x,p.y,p.z,p.w):new r.Quaternion(0,0,0,1)):t.makeRotationFromQuaternion(this.el.object3D.quaternion),null==l&&(l=this.data.transitionDuration),e.copy(this.el.object3D.position),i.copy(e),i.addScaledVector(this.velocity,l/3),n.copy(c),o.copy(c),a.copy(this.el.object3D.quaternion),h.setFromRotationMatrix(t),this.transition.active=!0,this.transition.startedAt=null,this.transition.endsAt=null,this.transition.duration=1e3*l,this.transition.positionCurve=s,this.transition.rotationFunc=u}}(),startZoomTo:function(){const t=new r.Vector2,e=new r.Vector2,i=new r.Vector2,n=new r.Vector2,o=new r.Vector2,s=new r.CubicBezierCurve(t,e,i,n);return function(r){if(!this.el||!this.el.sceneEl)return;const a=this.el.sceneEl.camera;if(!a)return;r=Math.max(Math.min(r,this.data.maxZoom),this.data.minZoom);t.set(a.zoom,0),e.copy(t),o.set(this._zoomOperation.velocity,0),e.addScaledVector(o,500/3),i.set(r,0),n.copy(i),this._zoomOperation.active=!0,this._zoomOperation.startedAt=null,this._zoomOperation.endsAt=null,this._zoomOperation.duration=500,this._zoomOperation.curve=s}}(),zoomInBy(t){const e=this._getCurrentCameraZoom();e&&e>0&&this.startZoomTo(e+t)},zoomInByMultiplicative(t){const e=this._getCurrentCameraZoom();e&&e>0&&this.startZoomTo(e*t)},_finishDragRotation(){this.mouseDrag.active&&(this.mouseDrag.active=!1,this.mouseDrag.startedAtX=null,this.mouseDrag.startedAtY=null)},_finishTransition(t){this.transition.active=!1,this.transition.startedAt=null,this.transition.endsAt=null,this.transition.duration=null,this.transition.positionCurve=null,this.transition.rotationFunc=null,t&&t.clearVelocity&&this.velocity.multiplyScalar(0)},_finishZoom(){this._zoomOperation.active=!1,this._zoomOperation.startedAt=null,this._zoomOperation.endsAt=null,this._zoomOperation.duration=null,this._zoomOperation.curve=null,this._zoomOperation.velocity=0},_attachKeyEventListeners(){const t=this.data.embedded?this.el.sceneEl:window;t.addEventListener("keydown",this._onKeyDown),t.addEventListener("keyup",this._onKeyUp)},_attachMouseEventListeners(){const{sceneEl:t}=this.el,e=t.canvas;e.addEventListener("mousedown",this._onMouseDown,!1),window.addEventListener("mousemove",this._onMouseMove,!1),window.addEventListener("mouseup",this._onMouseUp,!1),e.addEventListener("wheel",this._onMouseWheel,!1),e.addEventListener("touchstart",this._onTouchStart,!1),window.addEventListener("touchmove",this._onTouchMove,!1),window.addEventListener("touchend",this._onTouchEnd,!1)},_attachVisibilityEventListeners(){window.addEventListener("blur",this._onBlur),window.addEventListener("focus",this._onFocus),document.addEventListener("visibilitychange",this._onVisibilityChange)},_removeKeyEventListeners(){const t=this.data.embedded?this.el.sceneEl:window;t.removeEventListener("keydown",this._onKeyDown),t.removeEventListener("keyup",this._onKeyUp)},_removeMouseEventListeners(){const{sceneEl:t}=this.el,e=t.canvas;e.removeEventListener("mousedown",this._onMouseDown),window.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("mouseup",this._onMouseUp),e.removeEventListener("wheel",this._onMouseWheel),e.removeEventListener("touchstart",this._onTouchStart),window.removeEventListener("touchmove",this._onTouchMove),window.removeEventListener("touchend",this._onTouchEnd)},_removeVisibilityEventListeners(){window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),document.removeEventListener("visibilitychange",this.onVisibilityChange)},_onBlur(){this.pause()},_onFocus(){this.play()},_onVisibilityChange(){document.hidden?this._onBlur():this._onFocus()},_onKeyDown(t){if(!this.data.embedded&&!function(t,e="legacy"){switch(e){case"always":return!0;case"legacy":return!t.metaKey&&document.activeElement===document.body;case"notEditable":return!(t.metaKey||document.activeElement&&document.activeElement!==document.body&&document.activeElement.isContentEditable);default:return!1}}(t,this.data.acceptsKeyboardEvent))return;"+"===t.key?this.zoomInByMultiplicative(this.data.zoomStep):this.zoomInByMultiplicative(1/this.data.zoomStep);const e=t.code||s[t.keyCode];h.has(e)&&(this.keys[e]=!0,this.transition.active&&this._finishTransition())},_onKeyUp(t){const e=t.code||s[t.keyCode];delete this.keys[e]},_onMouseDown(t){this.data.enabled&&this.data.mouseDragEnabled&&0===t.button&&this._startDragRotationAt(t.screenX,t.screenY)},_onMouseMove(t){this.mouseDrag.active&&this.data.enabled&&this.data.mouseDragEnabled&&this._handleDragRotation(t.screenX,t.screenY,this.data.reverseMouseDrag)},_onMouseUp(){this._finishDragRotation()},_onMouseWheel(t){if(this.data.enabled&&this.data.mouseWheelEnabled){const e=(1===t.deltaMode?16:1)*(this.data.mouseWheelInverted?-1:1),i=t.deltaY*e/100*this.data.mouseWheelSensitivity;this.zoomInBy(-i)}},_onTouchStart(t){this.data.enabled&&this.data.touchDragEnabled&&1===t.touches.length&&this._startDragRotationAt(t.touches[0].screenX,t.touches[0].screenY)},_onTouchMove(t){this.mouseDrag.active&&this.data.enabled&&this.data.touchDragEnabled&&this._handleDragRotation(t.touches[0].screenX,t.touches[0].screenY,this.data.reverseTouchDrag)},_onTouchEnd(){this._finishDragRotation()},_bindMethods(){this._onBlur=this._onBlur.bind(this),this._onFocus=this._onFocus.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onKeyUp=this._onKeyUp.bind(this),this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onTouchMove=this._onTouchMove.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this)},_getCurrentCameraZoom(){if(this.el&&this.el.sceneEl&&this.el.sceneEl.camera){const t=this.el.sceneEl.camera;return this._zoomOperation.active?this._zoomOperation.curve.v3.x:t.zoom}return null}})},87192:(t,e,i)=>{"use strict";var n=i(2999);const{AdditiveBlending:o,NormalBlending:s,Sprite:r,SpriteMaterial:a}=n.Z.THREE;n.Z.registerComponent("sprite",{schema:{blending:{type:"string",default:"normal"},color:{type:"color",default:"#ffffff"},src:{type:"map"},scale:{type:"vec3",default:{x:1,y:1,z:1}},transparent:{type:"boolean",default:!0}},init(){this.map=null,this.material=new a({}),this.sprite=new r(this.material)},update(t){const e=this.el;if(this.data.src!==t.src){const t=this.data.src;e.sceneEl.systems.material.loadTexture(t,{src:t},(e=>{this.data.src===t&&(this.material.map=e,this.material.needsUpdate=!0)}))}if(this.data.blending!==t.blending){switch(this.data.blending){case"additive":this.material.blending=o;break;case"normal":this.material.blending=s}this.material.needsUpdate=!0}this.data.color!==t.color&&(this.material.color.set(this.data.color),this.material.needsUpdate=!0),this.data.transparent!==t.transparent&&(this.material.transparent=this.data.transparent,this.material.needsUpdate=!0);let i=e.getObject3D("mesh");i?i.scale.copy(this.data.scale):(i=new r(this.material),i.scale.copy(this.data.scale),e.setObject3D("mesh",i))},remove(){this.el.removeObject3D("mesh")}}),n.Z.registerPrimitive("a-sprite",{defaultComponents:{sprite:{}},mappings:{src:"sprite.src",resize:"sprite.scale"}})},95565:()=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");AFRAME.registerComponent("environment",{schema:{active:{default:!1},preset:{default:"default",oneOf:["none","default","contact","egypt","checkerboard","forest","goaland","yavapai","goldmine","arches","threetowers","poison","tron","japan","dream","volcano","starry","osiris"]},seed:{type:"int",default:1,min:0,max:1e3},skyType:{default:"color",oneOf:["none","color","gradient","atmosphere"]},skyColor:{type:"color"},horizonColor:{type:"color"},lighting:{default:"distant",oneOf:["none","distant","point"]},shadow:{default:!1},shadowSize:{default:10},lightPosition:{type:"vec3",default:{x:0,y:1,z:-.2}},fog:{type:"float",default:0,min:0,max:1},flatShading:{default:!1},playArea:{type:"float",default:1,min:.5,max:10},ground:{default:"hills",oneOf:["none","flat","hills","canyon","spikes","noise"]},groundYScale:{type:"float",default:3,min:0,max:50},groundTexture:{default:"none",oneOf:["none","checkerboard","squares","walkernoise"]},groundColor:{type:"color",default:"#553e35"},groundColor2:{type:"color",default:"#694439"},dressing:{default:"none",oneOf:["none","cubes","pyramids","cylinders","hexagons","stones","trees","mushrooms","towers","apparatus","arches","torii"]},dressingAmount:{type:"int",default:10,min:0,max:1e3},dressingColor:{type:"color",default:"#795449"},dressingScale:{type:"float",default:5,min:0,max:100},dressingVariance:{type:"vec3",default:{x:1,y:1,z:1}},dressingUniformScale:{default:!0},dressingOnPlayArea:{type:"float",default:0,min:0,max:1},grid:{default:"none",oneOf:["none","1x1","2x2","crosses","dots","xlines","ylines"]},gridColor:{type:"color",default:"#ccc"}},multiple:!1,presets:{none:{},default:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:1,z:.33},fog:.78,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"checkerboard",groundColor:"#454545",groundColor2:"#5d5d5d",dressing:"none",dressingAmount:10,dressingColor:"#795449",dressingScale:1,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#ccc",shadow:!1},contact:{active:!0,seed:14,skyType:"gradient",skyColor:"#478d54",horizonColor:"#b696cb",lighting:"distant",lightPosition:{x:0,y:2.01,z:-1},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#2e455f",groundColor2:"#694439",dressing:"apparatus",dressingAmount:7,dressingColor:"#657067",dressingScale:20,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#478d54",shadow:!1},egypt:{active:!0,seed:26,skyType:"gradient",skyColor:"#1b7660",horizonColor:"#e4b676",lighting:"distant",lightPosition:{x:0,y:1.65,z:-1},fog:.75,flatShading:!1,playArea:1,ground:"hills",groundYScale:5,groundTexture:"walkernoise",groundColor:"#664735",groundColor2:"#6c4b39",dressing:"pyramids",dressingAmount:10,dressingColor:"#7c5c45",dressingScale:5,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},checkerboard:{active:!0,seed:1,skyType:"gradient",skyColor:"#0d0d0d",horizonColor:"#404040",lighting:"distant",lightPosition:{x:0,y:1,z:-.2},fog:.81,flatShading:!0,playArea:1,ground:"hills",groundYScale:4.81,groundTexture:"checkerboard",groundColor:"#252525",groundColor2:"#111111",dressing:"cubes",dressingAmount:10,dressingColor:"#9f9f9f",dressingScale:1.51,dressingVariance:{x:5,y:20,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#ccc",shadow:!1},forest:{active:!0,seed:8,skyType:"gradient",skyColor:"#24b59f",horizonColor:"#eff9b7",lighting:"distant",lightPosition:{x:-1.2,y:.88,z:-.55},fog:.8,flatShading:!1,playArea:1,ground:"noise",groundYScale:4.18,groundTexture:"squares",groundColor:"#937a24",groundColor2:"#987d2e",dressing:"trees",dressingAmount:500,dressingColor:"#888b1d",dressingScale:1,dressingVariance:{x:10,y:10,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#c5a543",shadow:!1},goaland:{active:!0,seed:17,skyType:"gradient",skyColor:"#14645f",horizonColor:"#a3dab8",lighting:"point",lightPosition:{x:.1,y:4,z:.56},fog:.73,flatShading:!1,playArea:1,ground:"noise",groundYScale:.81,groundTexture:"none",groundColor:"#ae3241",groundColor2:"#db4453",dressing:"mushrooms",dressingAmount:150,dressingColor:"#a9313d",dressingScale:5,dressingVariance:{x:5,y:10,z:5},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"dots",gridColor:"#239893",shadow:!1},yavapai:{active:!0,seed:11,skyType:"gradient",skyColor:"#239849",horizonColor:"#cfe0af",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#C66344",groundColor2:"#c96b4b",dressing:"stones",dressingAmount:500,dressingColor:"#C66344",dressingScale:.06,dressingVariance:{x:.2,y:.1,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},goldmine:{active:!0,seed:53,skyType:"gradient",skyColor:"#1e1c1a",horizonColor:"#8c7964",lighting:"point",lightPosition:{x:-.09,y:3,z:.33},fog:.43,flatShading:!0,playArea:1.08,ground:"canyon",groundYScale:50,groundTexture:"none",groundColor:"#353535",groundColor2:"#454545",dressing:"hexagons",dressingAmount:300,dressingColor:"#fe921b",dressingScale:.5,dressingVariance:{x:2,y:8,z:2},dressingUniformScale:!0,dressingOnPlayArea:.03,grid:"none",gridColor:"#ccc",shadow:!1},threetowers:{active:!0,seed:5,skyType:"gradient",skyColor:"#23a06b",horizonColor:"#f5e170",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.26,groundTexture:"walkernoise",groundColor:"#273a49",groundColor2:"#2b464f",dressing:"towers",dressingAmount:3,dressingColor:"#5f6d94",dressingScale:50,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"none",gridColor:"#239893",shadow:!1},poison:{active:!0,seed:92,skyType:"gradient",skyColor:"#1ea84a",horizonColor:"#177132",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"none",groundColor:"#851f31",groundColor2:"#912235",dressing:"hexagons",dressingAmount:20,dressingColor:"#c7415b",dressingScale:20,dressingVariance:{x:20,y:200,z:20},dressingUniformScale:!1,dressingOnPlayArea:0,grid:"crosses",gridColor:"#1ea84a",shadow:!1},arches:{active:!0,seed:19,skyType:"atmosphere",skyColor:"#8cbdc8",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:-.11,y:.16,z:.33},fog:.67,flatShading:!0,playArea:1,ground:"canyon",groundYScale:10,groundTexture:"walkernoise",groundColor:"#a87d6f",groundColor2:"#795449",dressing:"arches",dressingAmount:6,dressingColor:"#795449",dressingScale:26,dressingVariance:{x:20,y:40,z:20},dressingUniformScale:!0,dressingOnPlayArea:.04,grid:"none",gridColor:"#ccc",shadow:!1},tron:{active:!0,seed:14,skyType:"gradient",skyColor:"#091b39",horizonColor:"#284a9e",lighting:"distant",lightPosition:{x:-.72,y:.62,z:.4},fog:.8,flatShading:!1,playArea:1,ground:"spikes",groundYScale:4.91,groundTexture:"none",groundColor:"#061123",groundColor2:"#694439",dressing:"towers",dressingAmount:5,dressingColor:"#fb000e",dressingScale:15,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"1x1",gridColor:"#fb000e",shadow:!1},japan:{active:!0,seed:14,skyType:"gradient",skyColor:"#7e5db5",horizonColor:"#b4adda",lighting:"distant",lightPosition:{x:1.33,y:1,z:.24},fog:.9,flatShading:!1,playArea:1,ground:"hills",groundYScale:25,groundTexture:"walkernoise",groundColor:"#7e5db5",groundColor2:"#cabdf5",dressing:"torii",dressingAmount:4,dressingColor:"#bc5e7c",dressingScale:15,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,dressingOnPlayArea:0,grid:"spots",gridColor:"#e4b676",shadow:!1},dream:{active:!0,seed:17,skyType:"gradient",skyColor:"#87faf4",horizonColor:"#b34093",lighting:"distant",lightPosition:{x:-.72,y:.53,z:.97},fog:.8,flatShading:!1,playArea:1,ground:"hills",groundYScale:20,groundTexture:"checkerboard",groundColor:"#b34093",groundColor2:"#c050a2",dressing:"mushrooms",dressingAmount:300,dressingColor:"#3cf7ed",dressingScale:.2,dressingVariance:{x:.2,y:.2,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1},volcano:{active:!0,seed:92,skyType:"gradient",skyColor:"#4a070f",horizonColor:"#f62300",lighting:"point",lightPosition:{x:.5,y:2.25,z:0},fog:.87,flatShading:!1,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#fb0803",groundColor2:"#510000",dressing:"arches",dressingAmount:15,dressingColor:"#fb0803",dressingScale:3,dressingVariance:{x:10,y:100,z:10},dressingUniformScale:!1,dressingOnPlayArea:.2,grid:"none",gridColor:"#fa0e00",shadow:!1},starry:{active:!0,seed:1,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:-.01,z:-.46},fog:.7,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#553e35",groundColor2:"#694439",dressing:"none",dressingAmount:100,dressingColor:"#795449",dressingScale:5,dressingVariance:{x:1,y:1,z:1},dressingUniformScale:!0,grid:"1x1",dressingOnPlayArea:0,gridColor:"#39d2f2",shadow:!1},osiris:{active:!0,seed:46,skyType:"atmosphere",skyColor:"#88c",horizonColor:"#ddd",lighting:"distant",lightPosition:{x:0,y:.02,z:-.46},fog:0,flatShading:!1,playArea:1,ground:"hills",groundYScale:3,groundTexture:"none",groundColor:"#9e7b47",groundColor2:"#9e7b47",dressing:"pyramids",dressingAmount:7,dressingColor:"#9e7b47",dressingScale:5,dressingVariance:{x:30,y:30,z:30},dressingUniformScale:!0,grid:"dots",dressingOnPlayArea:0,gridColor:"#daa452",shadow:!1},moon:{active:!0,seed:11,skyType:"gradient",skyColor:"#000000",horizonColor:"#000000",lighting:"distant",lightPosition:{x:.5,y:1,z:0},fog:.8,flatShading:!0,playArea:1,ground:"canyon",groundYScale:9.76,groundTexture:"walkernoise",groundColor:"#D1D1D1",groundColor2:"#494949",dressing:"stones",dressingAmount:500,dressingColor:"#494949",dressingScale:.06,dressingVariance:{x:.2,y:.1,z:.2},dressingUniformScale:!0,dressingOnPlayArea:1,grid:"none",gridColor:"#239893",shadow:!1}},init:function(){for(var t in this.environmentData={},this.STAGE_SIZE=200,this.assets={arches:[{type:"mesh",vertices:[409,268,4,351,228,36,336,236,-57,-152,391,69,-135,358,88,-119,330,43,-20,358,-35,-153,357,-47,37,413,-26,-20,411,-14,-302,148,154,-339,121,-126,-389,200,-88,-477,193,-76,-314,346,-19,-314,306,-30,-250,296,-73,-267,237,-82,-212,303,-68,-245,200,-67,-223,304,108,-329,299,107,-289,350,76,-320,342,69,119,373,-39,38,370,8,113,367,52,492,202,-31,462,83,-104,447,71,-80,426,112,25,482,189,-7,222,372,6,121,402,41,87,382,67,221,346,55,559,93,-13,528,47,39,505,21,-111,528,54,-101,616,31,-53,442,256,-15,300,338,19,257,308,-79,408,256,-74,312,352,-26,384,297,-31,437,257,-47,-29,415,53,-232,377,59,-139,335,77,-132,344,2,-18,377,-37,-171,387,-28,-254,384,18,-651,-27,27,-435,-28,179,-345,149,165,-272,-28,23,-215,146,-2,-279,-29,-59,-211,145,-55,-337,-28,-128,-413,247,0,-293,363,24,-214,254,-36,-164,290,33,-284,150,94,-218,362,105,75,369,29,518,147,-63,447,190,-70,445,56,-105,391,185,-60,431,49,-33,459,83,26,470,162,42,130,390,53,167,341,-30,125,394,-45,239,368,-17,91,414,10,450,18,2,449,-27,-9,436,-28,-58,496,-27,-110,582,-28,-140,647,-27,-56,325,325,-45,-307,297,-56,-647,-28,-45,-188,310,-54,-264,197,113,-367,175,139,8,387,82,426,45,-55,114,359,-28,500,27,44,461,-29,13,-512,-27,-151,-152,376,-38,-490,-28,148,12,370,-28,442,160,42,465,194,32,381,183,-33,649,-27,-34,444,16,29,616,-28,25,417,267,-66,-132,352,-34,-322,-27,130,-271,86,-115,-635,-28,-121,-291,203,-99,176,405,-10,561,52,-93,371,305,9,311,237,-22,377,200,-81,-129,406,46,-154,371,99,-82,361,71,-21,354,26,-91,363,-27,-165,413,-12,-414,215,110,-238,127,26,-408,-28,-128,-674,-28,-94,-446,232,-39,-311,226,-90,-255,210,-61,-235,192,-11,-217,218,58,-269,299,124,-386,276,78,-399,281,42,15,373,58,16,393,75,549,107,-46,481,188,-68,409,120,-41,541,81,12,230,368,41,194,350,-50,224,361,-50,604,-28,-10,602,-27,35,486,56,-121,502,69,-120,457,-27,-110,226,317,-40,-584,-28,-124,439,-26,-30,467,-26,39,547,-27,-146,21,368,14,466,229,-29,578,-27,44,609,-27,-96,291,356,-15,290,306,34,255,321,28,231,311,-5,-251,386,50,-183,307,87,-152,307,24,-264,373,-12,-392,-27,190,-333,-28,84,-281,-27,54,-270,-28,-23,-308,-28,-101,-687,-27,-59,39,418,39,413,163,25,404,206,-90,54,400,-31,121,352,8,-454,41,148,-426,9,182,-564,115,3,-427,27,-107,-548,118,-32,-556,122,-53,-517,91,-101,-475,54,140,-461,52,-134,-558,119,-71,-434,286,59,-687,-31,52,-595,146,22,-670,-28,164,-537,166,122,-575,-28,217,-566,159,65,-470,152,136,-712,-29,102,-639,-29,211,-532,-30,181,-442,-30,-100],faces:[76,104,162,1,176,103,103,76,1,2,119,73,73,105,2,2,118,152,45,161,46,46,109,45,3,120,49,49,68,3,3,121,139,139,48,3,4,122,94,94,121,4,6,123,124,9,175,81,10,169,111,10,67,92,88,43,146,11,131,114,11,128,183,13,130,15,90,184,174,90,182,184,130,184,63,14,130,63,15,130,14,16,131,12,15,168,53,18,91,17,131,16,17,65,133,132,65,132,91,67,134,166,166,92,67,20,135,92,20,166,4,4,121,20,22,135,68,25,102,96,25,157,102,69,138,157,69,157,25,39,150,71,71,141,39,28,150,149,149,72,28,142,176,105,36,140,27,27,143,36,32,115,81,32,144,161,161,80,32,77,35,144,34,26,77,78,179,96,145,152,78,178,79,145,80,146,79,147,140,36,143,108,36,143,37,148,74,95,154,154,83,74,72,149,151,151,95,72,38,150,156,40,147,106,70,140,40,40,116,70,42,162,0,35,163,162,43,145,146,46,117,41,47,158,27,48,139,175,122,138,94,157,138,123,52,178,102,52,102,6,52,124,7,7,100,52,53,125,8,57,93,181,56,169,181,59,127,58,60,173,61,62,128,11,11,112,62,65,91,167,65,167,66,126,93,21,22,68,49,72,95,29,142,29,74,74,82,142,75,107,97,75,97,103,76,97,37,104,143,31,78,152,164,78,164,179,79,178,8,97,155,159,107,98,155,83,98,82,154,95,84,39,116,86,86,156,39,87,160,116,24,145,96,162,104,0,105,118,2,43,177,119,44,177,43,91,51,167,44,88,109,46,161,117,3,68,121,3,48,120,4,166,50,50,122,4,5,123,122,123,138,122,110,124,51,170,10,111,110,91,7,7,124,110,8,125,9,9,81,8,186,12,188,92,135,10,11,114,112,64,63,137,13,15,89,89,53,100,64,168,14,14,168,15,89,100,16,16,12,89,100,18,16,17,91,132,112,19,61,18,7,91,19,17,132,133,127,59,133,59,61,136,21,22,134,127,133,20,92,166,121,135,20,158,31,27,21,135,22,23,137,136,24,102,178,178,145,24,25,179,69,26,94,138,27,140,70,27,70,141,150,177,71,28,177,150,29,142,73,73,119,29,142,82,30,30,176,142,107,75,82,31,143,27,33,81,175,31,41,104,115,79,8,32,33,144,80,115,32,33,175,139,35,162,42,77,139,34,163,26,179,163,179,164,78,96,145,177,29,119,108,143,148,148,37,159,97,159,37,74,83,82,38,149,150,156,150,39,40,106,87,87,116,40,140,147,40,161,144,42,42,117,161,41,0,104,41,117,0,0,117,42,164,118,163,1,163,118,118,176,1,118,105,176,152,118,164,43,152,145,43,119,2,71,109,141,47,41,158,44,71,177,45,109,88,45,88,146,46,47,109,141,47,27,167,50,166,49,120,165,139,121,94,5,122,50,123,51,124,157,6,102,157,123,6,100,8,178,5,167,51,6,124,52,100,178,52,53,168,125,125,165,120,54,125,168,9,48,175,120,9,125,93,10,135,181,101,56,57,169,10,59,172,61,67,170,171,67,171,127,58,127,171,129,186,113,60,61,172,61,173,112,62,112,173,174,189,129,165,64,23,64,137,23,165,22,49,64,54,168,17,114,131,17,112,114,66,133,65,19,132,133,19,133,61,134,133,66,166,134,66,166,66,167,93,135,21,68,135,121,23,136,22,94,34,139,25,96,179,26,138,69,69,179,26,30,103,176,116,141,70,39,141,116,73,142,105,143,76,37,26,35,77,103,97,76,77,144,33,33,139,77,38,151,149,80,161,45,80,45,146,81,115,8,107,155,97,82,98,107,95,151,84,38,156,85,86,116,160,96,102,24,72,29,28,29,95,74,75,30,82,108,147,36,88,44,43,91,110,51,170,67,10,11,183,131,64,14,63,89,15,53,100,7,18,112,17,19,127,134,67,136,126,21,158,41,31,33,32,81,115,80,79,177,28,29,43,2,152,71,44,109,47,46,41,141,109,47,167,5,50,123,5,51,100,53,8,125,54,165,9,120,48,93,57,10,59,58,172,174,185,189,165,54,64,165,23,22,94,26,34,30,75,103,143,104,76,26,163,35,38,85,151,192,182,191,183,128,201,12,13,89,181,169,57,186,153,113,188,183,99,184,182,63,185,13,189,180,181,93,186,99,153,189,186,129,185,184,130,186,13,12,187,93,126,193,199,194,194,196,193,200,187,195,187,197,195,187,126,197,197,190,194,190,136,137,190,196,194,63,182,192,63,192,196,192,198,196,191,182,55,193,196,198,194,199,197,195,197,199,136,197,126,190,137,63,190,63,196,197,136,190,192,191,198,201,99,183,90,55,182,181,180,101,185,130,13,186,188,99,186,189,13,187,180,93,200,101,187,183,188,131,184,185,174,180,187,101,16,18,17,12,131,188,35,42,144,163,1,162,76,162,1,79,146,145]}],stones:[{type:"mesh",vertices:[-376,189,42,230,223,-310,353,162,-62,414,-23,-67,256,90,-475,24,85,-526,-418,-16,57,-432,66,-40,-199,151,-376,-155,49,467,-91,289,201,293,197,91,81,-17,-480,42,108,431,-359,-17,-250,383,-19,-243,194,-15,270,-272,180,293,-86,212,262,234,54,297,395,97,-302,-123,-21,-444,-416,-19,-123,-323,-18,267,-100,-16,429,-300,96,-361,163,-19,409,118,201,-431,-241,-18,391,-130,274,-309,306,-19,-399,-221,96,404],faces:[31,18,17,0,17,18,3,20,2,18,11,10,29,27,8,27,29,1,0,18,10,10,29,0,16,19,26,11,2,1,20,30,4,20,3,15,30,12,4,4,12,5,5,27,4,4,27,20,21,25,5,7,8,25,22,7,14,7,25,14,23,28,31,0,7,17,24,26,9,31,28,9,8,27,5,2,20,1,13,19,18,10,11,1,19,13,26,3,11,19,19,16,3,11,3,2,11,18,19,20,15,30,29,10,1,25,21,14,8,5,25,5,12,21,6,7,22,7,6,23,8,0,29,8,7,0,23,31,7,13,31,9,18,31,13,9,28,24,26,13,9,27,1,20,7,31,17]},{type:"mesh",vertices:[-217,34,-153,198,90,20,212,85,169,-131,93,171,197,113,30,173,121,164,315,29,-16,219,24,189,282,50,-102,232,38,-181,-195,-9,-166,-156,30,-207,-51,-9,-231,-180,91,-173,-19,73,-204,-280,23,96,-242,100,107,3,158,-82,109,88,221,275,-10,-40,236,-10,-135,-178,49,184,-1,-10,-243,265,-11,109,-12,-9,237,-36,46,251,-233,86,-81,93,77,-171,-163,133,69,18,16,263,296,44,93,131,-12,-226,-89,-10,-201,-273,-10,-51,-240,-9,110,190,-12,192,-253,-11,-92,42,43,-258,-115,-11,238,168,99,-88,-285,-10,24,71,124,-158,298,-10,10,116,150,-24,-282,44,39],faces:[44,16,26,13,26,16,0,26,13,27,14,41,4,5,1,7,30,2,28,5,43,41,39,27,17,43,41,43,4,39,13,28,17,17,41,13,28,43,17,24,29,38,29,35,7,18,25,29,5,18,2,18,5,3,30,42,6,30,35,23,19,20,8,8,20,9,9,39,8,1,30,8,31,37,9,11,14,37,14,27,37,32,11,12,11,37,12,11,0,13,33,40,44,44,26,33,33,0,36,34,38,15,44,40,15,21,3,16,27,39,9,2,30,1,21,25,3,16,3,28,28,3,5,4,43,5,41,43,39,13,16,28,25,21,38,38,29,25,7,18,29,29,24,35,18,7,2,18,3,25,30,23,42,30,7,35,8,30,6,6,19,8,6,42,19,8,39,1,37,31,22,27,9,37,9,20,31,10,11,32,11,10,0,12,37,22,14,13,41,14,11,13,33,26,0,36,0,10,21,44,15,16,44,21,15,40,34,38,21,15,4,1,39,5,2,1]},{type:"mesh",vertices:[-101,102,57,99,35,102,40,72,80,59,14,-168,-186,22,45,-176,25,-30,66,-7,146,153,-7,53,-110,47,-96,-90,-8,-146,150,-7,-12,-200,-7,8,-173,-7,-55,55,46,-60,125,-7,110,136,30,-10,-149,58,68,-15,82,-71,98,-7,-86,-34,-6,-194,-33,-7,171,-36,65,137,38,-8,-192,-103,-9,147,-12,62,-152],faces:[2,17,0,17,8,0,17,24,8,19,24,22,5,11,4,2,13,17,17,13,24,21,23,20,1,2,21,7,15,1,7,10,15,5,9,12,15,18,13,0,5,16,0,8,5,1,15,2,10,18,15,3,13,18,24,3,22,11,23,4,4,16,5,16,4,23,24,13,3,15,13,2,6,1,21,6,21,20,6,14,1,2,0,21,1,14,7,3,18,22,8,24,19,8,19,9,12,11,5,5,8,9,16,23,21,16,21,0]},{type:"mesh",vertices:[86,55,-18,58,38,73,97,-12,79,135,7,10,-93,-11,-72,-133,5,33,13,68,-32,94,-11,-57,-90,52,53,-24,-11,-106,-13,-10,104,-75,49,-69,-12,18,114,49,-12,-96,-46,-11,-85,-119,-11,-26,48,5,-111,-58,-11,105,-117,-12,52,-5,35,-93,123,-11,7],faces:[5,8,11,2,3,1,8,1,6,11,8,6,6,19,11,10,12,17,20,7,3,3,7,16,16,0,3,16,9,19,14,4,9,15,18,5,5,11,15,18,17,5,19,0,16,1,3,0,0,6,1,19,6,0,12,8,17,2,1,12,12,10,2,1,8,12,3,2,20,16,13,9,16,7,13,19,4,11,15,11,4,17,8,5,9,4,19]}],torii:[{type:"mesh",mirror:!0,flatShading:!0,vertices:[692,966,-52,661,834,-52,692,966,52,661,834,52,0,894,-52,0,776,-52,0,894,52,0,776,52,518,935,52,345,913,52,170,899,52,162,779,52,328,790,52,494,808,52,170,899,-52,345,913,-52,518,935,-52,494,808,-52,328,790,-52,162,779,-52,0,618,16,0,697,16,0,618,-16,0,697,-16,586,618,16,586,697,16,586,618,-16,586,697,-16,331,-29,-75,331,766,-52,369,-29,-65,357,766,-45,396,-29,-37,377,766,-26,406,-29,0,384,766,0,396,-29,37,377,766,26,369,-29,65,357,766,45,331,-29,75,331,766,52,294,-29,65,305,766,45,267,-29,37,286,766,26,257,-29,0,279,766,0,267,-29,-37,286,766,-26,294,-29,-65,305,766,-45,0,777,85,0,681,33,333,762,-75,333,806,-75,371,762,-65,371,806,-65,398,762,-37,398,806,-37,408,762,0,408,806,0,398,762,37,398,806,37,371,762,65,371,806,65,333,762,75,333,806,75,296,762,65,296,806,65,268,762,37,268,806,37,258,762,0,258,806,0,268,762,-37,268,806,-37,296,762,-65,296,806,-65,0,681,-33,0,777,-85,52,681,33,52,777,85,52,681,-33,52,777,-85],faces:[4,10,14,1,13,17,11,6,7,0,3,1,16,1,17,4,19,5,14,18,19,15,17,18,3,8,13,13,9,12,12,10,11,19,7,5,19,12,11,18,13,12,16,2,0,15,8,16,14,9,15,23,26,22,27,24,26,25,20,24,26,20,22,23,25,27,29,30,28,31,32,30,33,34,32,35,36,34,37,38,36,39,40,38,41,42,40,43,44,42,45,46,44,47,48,46,49,50,48,51,28,50,55,56,54,57,58,56,59,60,58,61,62,60,63,64,62,79,81,83,65,66,64,82,53,78,67,68,66,81,53,80,69,70,68,83,80,82,71,72,70,79,82,78,73,74,72,75,63,59,75,76,74,77,54,76,60,68,76,4,6,10,1,3,13,11,10,6,0,2,3,16,0,1,4,14,19,14,15,18,15,16,17,3,2,8,13,8,9,12,9,10,19,11,7,19,18,12,18,17,13,16,8,2,15,9,8,14,10,9,23,27,26,27,25,24,25,21,20,26,24,20,23,21,25,29,31,30,31,33,32,33,35,34,35,37,36,37,39,38,39,41,40,41,43,42,43,45,44,45,47,46,47,49,48,49,51,50,51,29,28,55,57,56,57,59,58,59,61,60,61,63,62,63,65,64,79,52,81,65,67,66,82,80,53,67,69,68,81,52,53,69,71,70,83,81,80,71,73,72,79,83,82,73,75,74,59,57,55,55,77,75,75,73,71,71,69,75,67,65,63,63,61,59,59,55,75,75,69,67,67,63,75,75,77,76,77,55,54,76,54,56,56,58,76,60,62,68,64,66,68,68,70,72,72,74,68,76,58,60,62,64,68,68,74,76]}],hexagons:[{type:"extrude",vertices:[-.198,-.302,.197,-.3,.372,0,.199,.298,-.202,.298,-.368,0]}],towers:[{type:"extrude",vertices:[-.054,-.178,-.007,-.182,.069,-.027,.189,.079,.178,.124,-.007,.097,-.145,.182,-.178,.144,-.079,-.021]},{type:"lathe",segments:4,vertices:[.004,.02,.012,.092,.042,.166,.067,.55,.101,.594,.105,.838,.193,.934,.18,.994]},{type:"lathe",segments:5,vertices:[.069,.216,.067,.562,.126,.562,.128,.774,.191,.774,.193,.986]}],trees:[{type:"lathe",noise:.015,segments:6,vertices:[1e-6,.826,.054,.832,.105,.854,.136,.9,.136,.958,.118,.994]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.01,.069,.022,.13,.068,.178,.18,.189,.32,.191,.59,.193,.75,.138,.79,.018,.808,.018,.996]},{type:"lathe",noise:.015,segments:14,vertices:[1e-6,.436,.126,.46,.201,.57,.219,.72,.154,.846,.028,.884,.034,.996]}],apparatus:[{type:"lathe",segments:10,vertices:[1e-6,.23,.042,.23,.069,.36,.038,.362,.038,.372,.06,.372,.073,.572,.024,.572,.024,.67,.069,.67,.075,.722,.097,.724,.105,.852,.083,.902,.065,.902,.065,.924,.128,.924,.146,.996]},{type:"lathe",segments:16,vertices:[1e-6,.232,.229,.182,.486,.07,.356,.182,.213,.242,.154,.242,.144,.262,.178,.262,.126,.314,.04,.328,.038,.374,.058,.374,.071,.408,.026,.406,.03,.42,.091,.418,.034,.496,.01,.498,.03,.506,.014,.998]}],mushrooms:[{type:"lathe",noise:.02,segments:14,vertices:[1e-6,.006,.13,.018,.341,.084,.437,.144,.492,.234,.484,.246,.276,.232,.107,.284,.046,.346,.062,.852,.097,.956,.166,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.562,.091,.572,.172,.61,.223,.666,.256,.74,.258,.806,.246,.824,.062,.826,.065,.948,.097,.998]},{type:"lathe",noise:.02,segments:10,vertices:[1e-6,.768,.099,.772,.219,.802,.306,.844,.352,.886,.352,.908,.118,.904,.107,.93,.115,.966,.14,.996]}]},this.assets)for(var e=0;e<this.assets[t].length;e++){var i=this.assets[t][e];if("mesh"==i.type)for(var n=0,o=i.vertices.length;n<o;n++)i.vertices[n]/=1e3}this.userFog=this.el.sceneEl.getAttribute("fog"),this.sky=document.createElement("a-sky"),this.sky.setAttribute("radius",this.STAGE_SIZE),this.sky.setAttribute("theta-length",110),this.sky.classList.add("environment"),this.stars=null,this.groundMaterial=null,this.ground=document.createElement("a-entity"),this.ground.setAttribute("rotation","-90 0 0"),this.ground.classList.add("environmentGround"),this.ground.classList.add("environment"),this.groundCanvas=null,this.groundTexture=null,this.groundMaterial=null,this.groundGeometry=null,this.dressing=document.createElement("a-entity"),this.dressing.classList.add("environmentDressing"),this.dressing.classList.add("environment"),this.gridCanvas=null,this.gridTexture=null,this.hemilight=document.createElement("a-entity"),this.hemilight.classList.add("environment"),this.hemilight.setAttribute("position","0 50 0"),this.hemilight.setAttribute("light",{type:"hemisphere",color:"#CEE4F0",intensity:.4}),this.sunlight=document.createElement("a-entity"),this.sunlight.classList.add("environment"),this.sunlight.setAttribute("position",this.data.lightPosition),this.sunlight.setAttribute("light",{intensity:.6}),this.el.appendChild(this.hemilight),this.el.appendChild(this.sunlight),this.el.appendChild(this.ground),this.el.appendChild(this.dressing),this.el.appendChild(this.sky)},getFogColor:function(t,e){var i;if("color"==t||"none"==t)i=new THREE.Color(this.environmentData.skyColor);else if("gradient"==t)i=new THREE.Color(this.environmentData.horizonColor);else if("atmosphere"==t){var n=[1,.5,.22,.1,.05,0],o=["#C0CDCF","#81ADC5","#525e62","#2a2d2d","#141616","#000"];if(e<=0)return"#000";e=Math.min(1,e);for(var s=0;s<n.length;s++)if(e>n[s]){var r=new THREE.Color(o[s-1]),a=new THREE.Color(o[s]),h=(e-n[s])/(n[s-1]-n[s]);a.lerp(r,h),i=a;break}}return i.multiplyScalar(.9),i.lerp(new THREE.Color(this.data.groundColor),.3),"#"+i.getHexString()},update:function(t){var e;this.data.preset?(e=AFRAME.utils.clone(this.environmentData),this.environmentData={},Object.assign(this.environmentData,this.data),Object.assign(this.environmentData,this.presets[this.data.preset]),Object.assign(this.environmentData,this.el.components.environment.attrValue)):(e=t,this.environmentData=this.data);var i=this.environmentData.skyType,n=new THREE.Vector3(this.environmentData.lightPosition.x,this.environmentData.lightPosition.y,this.environmentData.lightPosition.z);if(n.normalize(),this.sunlight){if(this.sunlight.setAttribute("position",this.environmentData.lightPosition),"atmosphere"!=i){var o=new THREE.Color(this.environmentData.skyColor);o.r=(o.r+1)/2,o.g=(o.g+1)/2,o.b=(o.b+1)/2,this.hemilight.setAttribute("light",{color:"#"+o.getHexString()}),this.sunlight.setAttribute("light",{intensity:.6}),this.hemilight.setAttribute("light",{intensity:.6})}else this.sunlight.setAttribute("light",{intensity:.1+.5*n.y}),this.hemilight.setAttribute("light",{intensity:.1+.5*n.y});this.sunlight.setAttribute("light",{castShadow:this.environmentData.shadow,shadowCameraLeft:-this.environmentData.shadowSize,shadowCameraBottom:-this.environmentData.shadowSize,shadowCameraRight:this.environmentData.shadowSize,shadowCameraTop:this.environmentData.shadowSize})}if(i!==e.skyType||this.environmentData.skyColor!=e.skyColor||this.environmentData.horizonColor!=e.horizonColor){var s={};s.shader={none:"flat",color:"flat",gradient:"gradientshader",atmosphere:"skyshader"}[i],this.stars&&this.stars.setAttribute("visible","atmosphere"==i),"color"==i?(s.color=this.environmentData.skyColor,s.fog=!1):"gradient"==i&&(s.topColor=this.environmentData.skyColor,s.bottomColor=this.environmentData.horizonColor),this.sky.setAttribute("material",s)}"atmosphere"==i&&(this.sky.setAttribute("material",{sunPosition:n}),this.setStars(2e3*(1-Math.max(0,8*(n.y+.08))))),this.environmentData.fog>0?this.el.sceneEl.setAttribute("fog",{color:this.getFogColor(i,n.y),far:(1.01-this.environmentData.fog)*this.STAGE_SIZE*2}):this.el.sceneEl.removeAttribute("fog"),this.sunlight.setAttribute("light",{type:"point"==this.environmentData.lighting?"point":"directional"}),this.sunlight.setAttribute("visible","none"!==this.environmentData.lighting),this.hemilight.setAttribute("visible","none"!==this.environmentData.lighting);var r=!this.groundGeometry||this.environmentData.seed!=e.seed||this.environmentData.ground!=e.ground||this.environmentData.playArea!=e.playArea||this.environmentData.flatShading!=e.flatShading;(r||this.environmentData.groundColor!=e.groundColor||this.environmentData.groundColor2!=e.groundColor2||this.environmentData.groundYScale!=e.groundYScale||this.environmentData.groundTexture!=e.groundTexture||this.environmentData.gridColor!=e.gridColor||this.environmentData.grid!=e.grid)&&(this.updateGround(r),this.hemilight&&this.hemilight.setAttribute("light",{groundColor:this.environmentData.groundColor})),this.environmentData.seed==e.seed&&this.environmentData.dressingOnPlayArea==e.dressingOnPlayArea&&this.environmentData.dressing==e.dressing&&this.environmentData.flatShading==e.flatShading&&this.environmentData.dressingAmount==e.dressingAmount&&this.environmentData.dressingScale==e.dressingScale&&this.environmentData.dressingColor==e.dressingColor&&this.environmentData.dressingVariance.x==e.dressingVariance.x&&this.environmentData.dressingVariance.y==e.dressingVariance.y&&this.environmentData.dressingVariance.z==e.dressingVariance.z&&this.environmentData.dressingUniformScale==e.dressingUniformScale||this.updateDressing(),this.sky.setAttribute("visible","none"!==i),this.el.setAttribute("visible",this.environmentData.active),this.environmentData.active||(this.userFog?this.el.sceneEl.setAttribute("fog",this.userFog):this.el.sceneEl.removeAttribute("fog")),this.dumpParametersDiff()},logPreset:function(){var t="{";for(var e in this.schema)if("preset"!=e){t+=e+": ";var i=this.schema[e].type;t+="vec3"==i?"{ x: "+this.environmentData[e].x+", y: "+this.environmentData[e].y+", z: "+this.environmentData[e].z+"}":"string"==i||"color"==i?'"'+this.environmentData[e]+'"':this.environmentData[e],t+=", "}t+="}"},dumpParametersDiff:function(){function t(t){return Math.floor(1e3*t)/1e3}var e=[],i="none"!=this.data.preset&&this.presets[this.data.preset];for(var n in i&&e.push("preset: "+this.data.preset),this.schema)if(!("preset"==n||i&&void 0===i[n])){var o=i?i[n]:this.schema[n].default,s=this.environmentData[n];if("vec3"==this.schema[n].type){var r=o;"string"==typeof o&&(r={x:(o=o.split(" "))[0],y:o[1],z:o[2]}),t(r.x)==t(s.x)&&t(r.y)==t(s.y)&&t(r.z)==t(s.z)||e.push(n+": "+t(s.x)+" "+t(s.y)+" "+t(s.z))}else o!=s&&("number"==this.schema[n].type&&(s=t(s)),e.push(n+": "+s))}},random:function(t){return parseFloat("0."+Math.sin(9999*this.environmentData.seed*t).toString().substr(7))},updateGround:function(e){if(e){var i="none"!=this.environmentData.ground;if(this.ground.setAttribute("visible",i),!i)return;this.groundGeometry||(this.groundGeometry=new THREE.PlaneGeometry(this.STAGE_SIZE+2,this.STAGE_SIZE+2,63,63));for(var n=new t(this.environmentData.seed),o=this.groundGeometry.attributes.position.array,s=o.length,r=10/64,a=0,h=0,l=2;l<s;l+=3)if("flat"!=this.environmentData.ground){var d;switch(this.environmentData.ground){case"hills":d=Math.max(0,n.noise(a,h,0));break;case"canyon":d=.2+.8*n.noise(a,h,0),d=Math.min(1,10*Math.pow(d,2));break;case"spikes":d=this.random(l)<.02?this.random(l+1):0;break;case"noise":d=this.random(l)<.35?this.random(l+1):0}d+=.1*this.random(l+2);var u=2*a/10-1,c=2*h/10-1,g=this.environmentData.playArea;(d*=(u=Math.max(0,Math.min(1,(Math.abs(u)-(g-.9))*(1/g))))>(c=Math.max(0,Math.min(1,(Math.abs(c)-(g-.9))*(1/g))))?u:c)<.01&&(d=0),o[l]=d,(a+=r)>=10&&(a=0,h+=r)}else o[l]=0;this.groundGeometry.computeVertexNormals(),this.groundGeometry.attributes.position.needsUpdate=!0,this.groundGeometry.attributes.normal.needsUpdate=!0}this.ground.setAttribute("scale",{z:this.environmentData.groundYScale});var m=2048,p=this.STAGE_SIZE/20;this.groundCanvas&&this.groundCanvas.width==m||(this.gridCanvas=document.createElement("canvas"),this.gridCanvas.width=m,this.gridCanvas.height=m,this.gridTexture=new THREE.Texture(this.gridCanvas),this.gridTexture.wrapS=THREE.RepeatWrapping,this.gridTexture.wrapT=THREE.RepeatWrapping,this.gridTexture.repeat.set(p,p),this.groundCanvas=document.createElement("canvas"),this.groundCanvas.width=m,this.groundCanvas.height=m,this.groundTexture=new THREE.Texture(this.groundCanvas),this.groundTexture.wrapS=THREE.RepeatWrapping,this.groundTexture.wrapT=THREE.RepeatWrapping,this.groundTexture.repeat.set(p,p),this.groundMaterialProps={map:this.groundTexture,emissive:new THREE.Color(16777215),emissiveMap:this.gridTexture},(new THREE.Material).hasOwnProperty("shading")?this.groundMaterialProps.shading=this.environmentData.flatShading?THREE.FlatShading:THREE.SmoothShading:this.groundMaterialProps.flatShading=this.environmentData.flatShading,this.groundMaterial=new THREE.MeshLambertMaterial(this.groundMaterialProps));var f=this.groundCanvas.getContext("2d"),v=this.gridCanvas.getContext("2d");if(this.drawTexture(f,m,20),v.fillStyle="#000000",v.fillRect(0,0,m,m),this.drawGrid(v,m,20),this.groundTexture.needsUpdate=!0,this.gridTexture.needsUpdate=!0,e){var y=new THREE.Mesh(this.groundGeometry,this.groundMaterial);this.ground.setObject3D("mesh",y)}else this.ground.getObject3D("mesh").material=this.groundMaterial;this.ground.setAttribute("shadow",{cast:!1,receive:this.environmentData.shadow})},drawGrid:function(t,e,i){if("none"!=this.environmentData.grid){var n,o,s,r=Math.floor(i/2),a=e/(i/2);switch(t.fillStyle=this.environmentData.gridColor,this.environmentData.grid){case"1x1":case"2x2":for("1x1"==this.environmentData.grid&&(r*=2,a=e/i),n=0;n<r;n++)s=Math.floor(n*a),t.fillRect(0,s,e,1),t.fillRect(s,0,1,e);break;case"crosses":var h=Math.floor(a/20);for(n=0;n<r+1;n++)for(s=Math.floor(n*a),o=0;o<r+1;o++){var l=Math.floor(o*a-h);t.fillRect(l,s,2*h,1),t.fillRect(s,l,1,2*h)}break;case"dots":for(n=0;n<r+1;n++)for(o=0;o<r+1;o++)t.beginPath(),t.arc(Math.floor(o*a),Math.floor(n*a),4,0,2*Math.PI),t.fill();break;case"xlines":for(n=0;n<r;n++)t.fillRect(Math.floor(n*a),0,1,e);break;case"ylines":for(n=0;n<r;n++)t.fillRect(0,Math.floor(n*a),e,1)}}},drawTexture:function(e,i,n){var o,s,r,a,h,l,d;if(e.fillStyle=this.environmentData.groundColor,e.fillRect(0,0,i,i),"none"!=this.environmentData.groundTexture)switch(this.environmentData.groundTexture){case"checkerboard":e.fillStyle=this.environmentData.groundColor2;var u=Math.floor(n/2),c=i/(n/2);for(o=0;o<u+1;o+=2)for(var g=0;g<u+1;g++)e.fillRect(Math.floor((o+g%2)*c),Math.floor(g*c),Math.floor(c),Math.floor(c));break;case"squares":var m=i/16;for(r=new THREE.Color(this.environmentData.groundColor),a=new THREE.Color(this.environmentData.groundColor2),o=0;o<256;o++)(s=this.random(o+3)>.5?r.clone():a.clone()).addScalar(.1*this.random(o+3)-.05),e.fillStyle="#"+s.getHexString(),e.fillRect(o%16*m,Math.floor(o/16)*m,m,m);break;case"noise":h=(l=e.getImageData(0,0,i,i)).data,r=new THREE.Color(this.environmentData.groundColor),a=new THREE.Color(this.environmentData.groundColor2);var p=new THREE.Color(a.r-r.r,a.g-r.g,a.b-r.b),f=new t;for(o=0,g=0,d=h.length;o<d;o+=4,g++){var v=f.noise(g%i/i*3,g/i/i*3,0);h[o+0]=Math.floor(255*(r.r+p.r*v)),h[o+1]=Math.floor(255*(r.g+p.g*v)),h[o+2]=Math.floor(255*(r.b+p.b*v))}e.putImageData(l,0,0);break;case"walkernoise":var y=Math.floor(i/2),b=document.createElement("canvas");b.width=y,b.height=y;var x=b.getContext("2d");x.fillStyle=this.environmentData.groundColor,x.fillRect(0,0,y,y),h=(l=x.getImageData(0,0,y,y)).data,r=new THREE.Color(this.environmentData.groundColor),a=new THREE.Color(this.environmentData.groundColor2);var w=[];for(o=0;o<1e3;o++)s=r.clone().lerp(a,Math.random()),w.push({x:Math.random()*y,y:Math.random()*y,r:Math.floor(255*s.r),g:Math.floor(255*s.g),b:Math.floor(255*s.b)});for(var E=0;E<5e3;E++)for(o=0;o<1e3;o++){var A=w[o],C=4*Math.floor(A.y*y+A.x);h[C+0]=A.r,h[C+1]=A.g,h[C+2]=A.b,A.x+=Math.floor(3*Math.random())-1,A.y+=Math.floor(3*Math.random())-1,A.x>=y&&(A.x=A.x-y),A.y>=y&&(A.y=A.y-y),A.x<0&&(A.x=y+A.x),A.y<0&&(A.y=y+A.y)}x.putImageData(l,0,0),e.drawImage(b,0,0,i,i)}},getAssetGeometry:function(t){if(!t)return null;var e,i,n,o=[],s=this;function r(t,e){new THREE.Vector3;for(var i=t.attributes.position.array,n=i.length,o=0;o<n;o+=3)i[o]=(s.random(o)-.5)*e,i[o+1]=(s.random(o+n)-.5)*e,i[o+2]=(s.random(o+2*n)-.5)*e;t.attributes.position.needsUpdate=!0}for(var a=0;a<t.length;a++)if("lathe"==t[a].type){var h=-99999,l=[];for(n=t[a].vertices,e=0;e<n.length;e+=2)l.push(new THREE.Vector2(n[e],n[e+1])),n[e+1]>h&&(h=n[e+1]);(i=new THREE.LatheGeometry(l,t[a].segments||8)).applyMatrix4((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI,0,0))),i.applyMatrix4((new THREE.Matrix4).makeTranslation(0,h,0)),i=i.toNonIndexed(),o.push(i)}else if("extrude"==t[a].type){var d=new THREE.Shape;for(n=t[a].vertices,e=0;e<n.length;e+=2)0==e?d.moveTo(n[e],n[e+1]):d.lineTo(n[e],n[e+1]);(i=new THREE.ExtrudeGeometry(d,{amount:1,bevelEnabled:!1})).applyMatrix4((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(-Math.PI/2,0,0))),t[a].noise&&r(i,t[a].noise),o.push(i)}else if("mesh"==t[a].type){i=new THREE.BufferGeometry,n=t[a].vertices;var u=t[a].faces,c=new Float32Array(n);if(i.setIndex(u),i.setAttribute("position",new THREE.BufferAttribute(c,3)),t[a].mirror){var g=i.clone();g.applyMatrix4((new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(0,Math.PI,0))),i=THREE.BufferGeometryUtils.mergeBufferGeometries([i,g])}t[a].noise&&r(i,t[a].noise),(i=i.toNonIndexed()).computeVertexNormals(),o.push(i)}return o},updateDressing:function(){var t=new THREE.Object3D,e=[];if(this.dressing.setAttribute("visible","none"!=this.environmentData.dressing),"none"!=this.environmentData.dressing){var i;switch(this.environmentData.dressing){case"cubes":(i=[new THREE.BoxGeometry(1,1,1)])[0].applyMatrix4((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"pyramids":(i=[new THREE.ConeGeometry(1,1,4,1,!0)])[0].applyMatrix4((new THREE.Matrix4).makeTranslation(0,.5,0));break;case"cylinders":(i=[new THREE.CylinderGeometry(.5,.5,1,8,1,!0)])[0].applyMatrix4((new THREE.Matrix4).makeTranslation(0,.5,0));break;default:if(!(i=this.getAssetGeometry(this.assets[this.environmentData.dressing])))return}for(var n=0,o=88343;n<this.environmentData.dressingAmount;n++,o++){i[Math.floor(this.random(33+n)*i.length)].clone;var s,r=i[Math.floor(this.random(33+n)*i.length)].clone(),a=this.environmentData.dressingScale,h=new THREE.Vector3(this.environmentData.dressingVariance.x,this.environmentData.dressingVariance.y,this.environmentData.dressingVariance.z);s=this.random(o)<this.environmentData.dressingOnPlayArea?15*this.random(o+1):10+Math.max(h.x,h.z)+10*this.random(o+1)+this.random(o+2)*this.STAGE_SIZE/3;var l=this.random(o+3)*Math.PI*2,d=new THREE.Matrix4,u=this.random(o+4),c=this.environmentData.dressingUniformScale;d.compose(new THREE.Vector3(Math.cos(l)*s,0,Math.sin(l)*s),(new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(0,1,0),(this.random(o+5)-.5)*h.length()*Math.PI*2),new THREE.Vector3(a+(c?u:this.random(o+6))*h.x,a+(c?u:this.random(o+7))*h.y,a+(c?u:this.random(o+8))*h.z)),r.applyMatrix4(d),e.push(r)}var g=THREE.BufferGeometryUtils.mergeBufferGeometries(e);g.attributes.position.needsUpdate=!0;var m=new THREE.MeshLambertMaterial({color:new THREE.Color(this.environmentData.dressingColor)}),p=new THREE.Mesh(g,m);t.add(p),this.dressing.setObject3D("mesh",t)}},createStars:function(){for(var t=new THREE.BufferGeometry,e=new Float32Array(6e3),i=this.STAGE_SIZE-1,n=new THREE.Vector3,o=0;o<e.length;o+=3)n.set(this.random(o+23)-.5,this.random(o+24),this.random(o+25)-.5),n.normalize(),n.multiplyScalar(i),e[o]=n.x,e[o+1]=n.y,e[o+2]=n.z;t.setAttribute("position",new THREE.BufferAttribute(e,3)),t.setDrawRange(0,0);var s=new THREE.PointsMaterial({size:.01,color:13421772,fog:!1});this.stars.setObject3D("mesh",new THREE.Points(t,s))},setStars:function(t){this.stars||(this.stars=document.createElement("a-entity"),this.stars.id="stars",this.createStars(),this.el.appendChild(this.stars)),t=Math.floor(Math.min(2e3,Math.max(0,t))),this.stars.getObject3D("mesh").geometry.setDrawRange(0,t)}}),AFRAME.registerShader("skyshader",{schema:{luminance:{type:"number",default:1,min:0,max:2,is:"uniform"},turbidity:{type:"number",default:2,min:0,max:20,is:"uniform"},reileigh:{type:"number",default:1,min:0,max:4,is:"uniform"},mieCoefficient:{type:"number",default:.005,min:0,max:.1,is:"uniform"},mieDirectionalG:{type:"number",default:.8,min:0,max:1,is:"uniform"},sunPosition:{type:"vec3",default:{x:0,y:0,z:-1},is:"uniform"},color:{type:"color",default:"#fff"}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D skySampler;","uniform vec3 sunPosition;","varying vec3 vWorldPosition;","vec3 cameraPos = vec3(0., 0., 0.);","uniform float luminance;","uniform float turbidity;","uniform float reileigh;","uniform float mieCoefficient;","uniform float mieDirectionalG;","const float e = 2.71828182845904523536028747135266249775724709369995957;","const float pi = 3.141592653589793238462643383279502884197169;","const float n = 1.0003;","const float N = 2.545E25;","const float pn = 0.035;","const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);","const vec3 K = vec3(0.686, 0.678, 0.666);","const float v = 4.0;","const float rayleighZenithLength = 8.4E3;","const float mieZenithLength = 1.25E3;","const vec3 up = vec3(0.0, 1.0, 0.0);","const float EE = 1000.0;","const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;","const float cutoffAngle = pi/1.95;","const float steepness = 1.5;","vec3 totalRayleigh(vec3 lambda)","{","return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));","}","vec3 simplifiedRayleigh()","{","return 0.0005 / vec3(94, 40, 18);","}","float rayleighPhase(float cosTheta)","{   ","return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));","}","vec3 totalMie(vec3 lambda, vec3 K, float T)","{","float c = (0.2 * T ) * 10E-18;","return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;","}","float hgPhase(float cosTheta, float g)","{","return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));","}","float sunIntensity(float zenithAngleCos)","{","return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));","}","// Filmic ToneMapping http://filmicgames.com/archives/75","float A = 0.15;","float B = 0.50;","float C = 0.10;","float D = 0.20;","float E = 0.02;","float F = 0.30;","float W = 1000.0;","vec3 Uncharted2Tonemap(vec3 x)","{","return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;","}","void main() ","{","float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);","float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));","vec3 sunDirection = normalize(sunPosition);","float sunE = sunIntensity(dot(sunDirection, up));","vec3 betaR = simplifiedRayleigh() * reileighCoefficient;","vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;","float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));","float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));","vec3 Fex = exp(-(betaR * sR + betaM * sM));","float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);","float rPhase = rayleighPhase(cosTheta*0.5+0.5);","vec3 betaRTheta = betaR * rPhase;","float mPhase = hgPhase(cosTheta, mieDirectionalG);","vec3 betaMTheta = betaM * mPhase;","vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));","Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));","vec3 direction = normalize(vWorldPosition - cameraPos);","float theta = acos(direction.y); // elevation --\x3e y-axis, [-pi/2, pi/2]","float phi = atan(direction.z, direction.x); // azimuth --\x3e x-axis [-pi/2, pi/2]","vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);","vec3 L0 = vec3(0.1) * Fex;","float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);","L0 += (sunE * 19000.0 * Fex)*sundisk;","vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));","vec3 texColor = (Lin+L0);   ","texColor *= 0.04 ;","texColor += vec3(0.0,0.001,0.0025)*0.3;","float g_fMaxLuminance = 1.0;","float fLumScaled = 0.1 / luminance;     ","float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ","float ExposureBias = fLumCompressed;","vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);","vec3 color = curr*whiteScale;","vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));","gl_FragColor.rgb = retColor;","gl_FragColor.a = 1.0;","}"].join("\n")}),AFRAME.registerShader("gradientshader",{schema:{topColor:{type:"color",default:"1 0 0",is:"uniform"},bottomColor:{type:"color",default:"0 0 1",is:"uniform"}},vertexShader:["varying vec3 vWorldPosition;","void main() {"," vec4 worldPosition = modelMatrix * vec4( position, 1.0 );"," vWorldPosition = worldPosition.xyz;"," gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );","}"].join("\n"),fragmentShader:["uniform vec3 bottomColor;","uniform vec3 topColor;","uniform float offset;","varying vec3 vWorldPosition;","void main() {"," float h = normalize( vWorldPosition ).y;"," gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );","}"].join("\n")});var t=function(t){var e,i;for(this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[],i=0;i<256;i++)e=parseFloat("0."+Math.sin(9999*t*i).toString().substr(7)),this.p[i]=Math.floor(256*e);for(this.perm=[],i=0;i<512;i++)this.perm[i]=this.p[255&i]};t.prototype.dot=function(t,e,i,n){return t[0]*e+t[1]*i+t[2]*n},t.prototype.mix=function(t,e,i){return(1-i)*t+i*e},t.prototype.fade=function(t){return t*t*t*(t*(6*t-15)+10)},t.prototype.noise=function(t,e,i){var n=Math.floor(t),o=Math.floor(e),s=Math.floor(i);t-=n,e-=o,i-=s,n&=255,o&=255,s&=255;var r=this.perm[n+this.perm[o+this.perm[s]]]%12,a=this.perm[n+this.perm[o+this.perm[s+1]]]%12,h=this.perm[n+this.perm[o+1+this.perm[s]]]%12,l=this.perm[n+this.perm[o+1+this.perm[s+1]]]%12,d=this.perm[n+1+this.perm[o+this.perm[s]]]%12,u=this.perm[n+1+this.perm[o+this.perm[s+1]]]%12,c=this.perm[n+1+this.perm[o+1+this.perm[s]]]%12,g=this.perm[n+1+this.perm[o+1+this.perm[s+1]]]%12,m=this.dot(this.grad3[r],t,e,i),p=this.dot(this.grad3[d],t-1,e,i),f=this.dot(this.grad3[h],t,e-1,i),v=this.dot(this.grad3[c],t-1,e-1,i),y=this.dot(this.grad3[a],t,e,i-1),b=this.dot(this.grad3[u],t-1,e,i-1),x=this.dot(this.grad3[l],t,e-1,i-1),w=this.dot(this.grad3[g],t-1,e-1,i-1),E=this.fade(t),A=this.fade(e),C=this.fade(i),M=this.mix(m,p,E),_=this.mix(y,b,E),T=this.mix(f,v,E),D=this.mix(x,w,E),S=this.mix(M,T,A),z=this.mix(_,D,A);return this.mix(S,z,C)}},80751:(t,e,i)=>{if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var n=i(62047);THREE.MeshLine=n.MeshLine,THREE.MeshLineMaterial=n.MeshLineMaterial,AFRAME.registerComponent("meshline",{schema:{color:{default:"#000"},lineWidth:{default:10},lineWidthStyler:{default:""},sizeAttenuation:{default:0},path:{default:[{x:-.5,y:0,z:0},{x:.5,y:0,z:0}],parse:function(t){return t.split(",").map(AFRAME.utils.coordinates.parse)},stringify:function(t){return t.map(AFRAME.utils.coordinates.stringify).join(",")}}},init:function(){this.resolution=new THREE.Vector2(window.innerWidth,window.innerHeight);var t=this.el.sceneEl;t.addEventListener("render-target-loaded",this.do_update.bind(this)),t.addEventListener("render-target-loaded",this.addlisteners.bind(this))},addlisteners:function(){window.addEventListener("resize",this.do_update.bind(this))},do_update:function(){var t=this.el.sceneEl.canvas;this.resolution.set(t.width,t.height),this.update()},update:function(){var t=new THREE.MeshLineMaterial({color:new THREE.Color(this.data.color),resolution:this.resolution,sizeAttenuation:this.data.sizeAttenuation,lineWidth:this.data.lineWidth}),e=[];this.data.path.forEach((function(t){e.push(t.x||0,t.y||0,t.z||0)}));var i="string"==typeof this.data.lineWidthStyler&&this.data.lineWidthStyler.length>0?new Function("p","return "+this.data.lineWidthStyler):function(){return 1},n=new THREE.MeshLine;n.setGeometry(new Float32Array(e),i),this.el.setObject3D("mesh",new THREE.Mesh(n.geometry,t))},remove:function(){this.el.removeObject3D("mesh")}})},62047:function(t,e){(function(){"use strict";var i=AFRAME.THREE;if(!i)throw new Error("MeshLine requires three.js");function n(){i.BufferGeometry.call(this),this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new i.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(t){this.setGeometry(t,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(t){this.setPoints(t,this.widthCallback)}}})}function o(t,e){var n=new i.Matrix4,o=new i.Ray,s=new i.Sphere,r=new i.Vector3,a=this.geometry;if(s.copy(a.boundingSphere),s.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(s,r)){n.getInverse(this.matrixWorld),o.copy(t.ray).applyMatrix4(n);var h=new i.Vector3,l=new i.Vector3,d=new i.Vector3,u=this instanceof i.LineSegments?2:1,c=a.index,g=a.attributes;if(null!==c)for(var m=c.array,p=g.position.array,f=g.width.array,v=0,y=m.length-1;v<y;v+=u){var b=m[v],x=m[v+1];h.fromArray(p,3*b),l.fromArray(p,3*x);var w=null!=f[Math.floor(v/3)]?f[Math.floor(v/3)]:1,E=t.params.Line.threshold+this.material.lineWidth*w/2,A=E*E;if(!(o.distanceSqToSegment(h,l,r,d)>A)){r.applyMatrix4(this.matrixWorld);var C=t.ray.origin.distanceTo(r);C<t.near||C>t.far||(e.push({distance:C,point:d.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this}),v=y)}}}}function s(t,e,i,n,o){var s;if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,o&&e+o):t.slice(e,o&&e+o):t,i.set)i.set(t,n);else for(s=0;s<t.length;s++)i[s+n]=t[s];return i}function r(t){i.ShaderMaterial.call(this,{uniforms:Object.assign({},i.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new i.Color(16777215)},opacity:{value:1},resolution:{value:new i.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new i.Vector2(1,1)}}),vertexShader:i.ShaderChunk.meshline_vert,fragmentShader:i.ShaderChunk.meshline_frag}),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(t)}n.prototype=Object.create(i.BufferGeometry.prototype),n.prototype.constructor=n,n.prototype.isMeshLine=!0,n.prototype.setMatrixWorld=function(t){this.matrixWorld=t},n.prototype.setGeometry=function(t,e){this._geometry=t,t instanceof i.BufferGeometry?this.setPoints(t.getAttribute("position").array,e):this.setPoints(t,e)},n.prototype.setPoints=function(t,e){if(t instanceof Float32Array||t instanceof Array){if(this._points=t,this.widthCallback=e,this.positions=[],this.counters=[],t.length&&t[0]instanceof i.Vector3)for(var n=0;n<t.length;n++){var o=t[n],s=n/t.length;this.positions.push(o.x,o.y,o.z),this.positions.push(o.x,o.y,o.z),this.counters.push(s),this.counters.push(s)}else for(n=0;n<t.length;n+=3){s=n/t.length;this.positions.push(t[n],t[n+1],t[n+2]),this.positions.push(t[n],t[n+1],t[n+2]),this.counters.push(s),this.counters.push(s)}this.process()}},n.prototype.raycast=o,n.prototype.compareV3=function(t,e){var i=6*t,n=6*e;return this.positions[i]===this.positions[n]&&this.positions[i+1]===this.positions[n+1]&&this.positions[i+2]===this.positions[n+2]},n.prototype.copyV3=function(t){var e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]},n.prototype.process=function(){var t,e,n=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],e=this.compareV3(0,n-1)?this.copyV3(n-2):this.copyV3(0),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);for(var o=0;o<n;o++){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(o/(n-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(o/(n-1),0),this.uvs.push(o/(n-1),1),o<n-1){e=this.copyV3(o),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);var s=2*o;this.indices_array.push(s,s+1,s+2),this.indices_array.push(s+2,s+1,s+3)}o>0&&(e=this.copyV3(o),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]))}e=this.compareV3(n-1,0)?this.copyV3(1):this.copyV3(n-1),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new i.BufferAttribute(new Float32Array(this.positions),3),previous:new i.BufferAttribute(new Float32Array(this.previous),3),next:new i.BufferAttribute(new Float32Array(this.next),3),side:new i.BufferAttribute(new Float32Array(this.side),1),width:new i.BufferAttribute(new Float32Array(this.width),1),uv:new i.BufferAttribute(new Float32Array(this.uvs),2),index:new i.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new i.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()},n.prototype.advance=function(t){var e=this._attributes.position.array,i=this._attributes.previous.array,n=this._attributes.next.array,o=e.length;s(e,0,i,0,o),s(e,6,e,0,o-6),e[o-6]=t.x,e[o-5]=t.y,e[o-4]=t.z,e[o-3]=t.x,e[o-2]=t.y,e[o-1]=t.z,s(e,6,n,0,o-6),n[o-6]=t.x,n[o-5]=t.y,n[o-4]=t.z,n[o-3]=t.x,n[o-2]=t.y,n[o-1]=t.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},i.ShaderChunk.meshline_vert=["",i.ShaderChunk.logdepthbuf_pars_vertex,i.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",i.ShaderChunk.logdepthbuf_vertex,i.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",i.ShaderChunk.fog_vertex,"}"].join("\n"),i.ShaderChunk.meshline_frag=["",i.ShaderChunk.fog_pars_fragment,i.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",i.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",i.ShaderChunk.fog_fragment,"}"].join("\n"),r.prototype=Object.create(i.ShaderMaterial.prototype),r.prototype.constructor=r,r.prototype.isMeshLineMaterial=!0,r.prototype.copy=function(t){return i.ShaderMaterial.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray.copy(t.dashArray),this.dashOffset.copy(t.dashOffset),this.dashRatio.copy(t.dashRatio),this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this},t.exports&&(e=t.exports={MeshLine:n,MeshLineMaterial:r,MeshLineRaycast:o}),e.MeshLine=n,e.MeshLineMaterial=r,e.MeshLineRaycast=o}).call(this)}}]);